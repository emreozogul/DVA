<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Viability Analysis</title>
    <script src="./js/jquery.js"></script>
    <script src="./js/cropper.js" type="module"></script>
    <link rel="stylesheet" href="./css/cropper.css">
    <script type="text/javascript" src="/eel.js"></script>
    <script src="./js/tiff.min.js"></script>
    <script src="./js/canvastotiff.min.js"></script>
    <link rel="stylesheet" href="./css/style.css">
    <script src="./js/index.js" ></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var cropper;
            document.getElementById('inputImage').addEventListener('change', function(event) {
                const files = event.target.files;
                if (files && files.length > 0) {
                    const file = files[0];
            
                    if (/\.tif$|\.tiff$/i.test(file.name)) {
                        // Handle TIFF file
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const buffer = e.target.result;
                            const tiff = new Tiff({buffer: buffer});
                            const canvas = tiff.toCanvas();
                            canvas.id = "image";
                            // set max width and height as 800px
                            
                            const imgContainer = document.querySelector('.img-container');
                            const imgContainerMock = document.querySelector('.img-container-mock');
                            imgContainer.style.display = "block";
                            imgContainerMock.style.display = "none";
                            imgContainer.innerHTML = ""; // Clear the container
                            imgContainer.appendChild(canvas);

            
                            // Initialize Cropper on the new canvas
                            if (cropper) {
                                cropper.destroy();
                            }
                            cropper = new Cropper(canvas, {
                                aspectRatio: 1 / 1,
                                background: false,
                                highlight: false,
                            });
                        };
                        reader.readAsArrayBuffer(file);
                    } else {
                        // Handle other file types as before
                    }
                }
            });
            
            document.getElementById('rotateLeft').addEventListener('click', function () {
            cropper.rotate(-45);
            });
        
            document.getElementById('rotateRight').addEventListener('click', function () {
            cropper.rotate(45);
            });
        
            document.getElementById('zoomIn').addEventListener('click', function () {
            cropper.zoom(0.1);
            });
        
            document.getElementById('zoomOut').addEventListener('click', function () {
            cropper.zoom(-0.1);
            });
            
            document.getElementById('crop').addEventListener('click', function() {
                var canvas = cropper.getCroppedCanvas();
                if (canvas) {
                    CanvasToTIFF.toBlob(canvas, function(blob) {
                        var url = URL.createObjectURL(blob);
                        var downloadLink = document.createElement('a');
                        downloadLink.href = url;
                        downloadLink.download = 'croppedImage.tiff';
                        document.body.appendChild(downloadLink);
                        downloadLink.click();
                        document.body.removeChild(downloadLink);
                        URL.revokeObjectURL(url);
                    });
                }
            });
            
            document.getElementById('select').addEventListener('click', function () {
            document.getElementById('inputImage').click();
            });
            
        });
        
        $(window).resize(function() {
            var minWidth = 800;
            var minHeight = 800;
            var currentWidth = window.innerWidth;
            var currentHeight = window.innerHeight;
            var newWidth = currentWidth < minWidth ? minWidth : currentWidth;
            var newHeight = currentHeight < minHeight ? minHeight : currentHeight;
            if (newWidth !== currentWidth || newHeight !== currentHeight) {
                window.resizeTo(newWidth, newHeight);
            }
        });
    </script>
</head>
<body class="app">
    <div class="sidebar" id="sidebar">
        <div href="javascript:void(0)" id="closebtn" class="closebtn" >×</div>
        <div class="navContainer">
            <div id="HomeNav"  class="navItem" data-section="Home" >Home</div>
            <div id="ImageNav"  class="navItem" data-section="Import" >Import</div>
            <div id="ProjectNav"  class="navItem" data-section="Project" >Project</div>
            <div id="CropNav"  class="navItem" data-section="Crop" >Crop</div>
            <div id="SettingsNav"  class="navItem" data-section="Settings" >Settings</div>

        </div>
        <div style="display: flex; align-items:center ; justify-content: center;"> 
            <div id="HelpNav">
                <svg width="40px" height="40px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                    <g id="SVGRepo_iconCarrier"> 
                        <path d="M12 17H12.01M12 14C12.8906 12.0938 15 12.2344 15 10C15 8.5 14 7 12 7C10.4521 7 9.50325 7.89844 9.15332 9M12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21Z" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> 
                    </g>
                </svg>   
            </div>
        </div>
    </div>
    <div id="openbtn" class="openbtn" >☰ </div>  
    <div class="page" id="Home">
        <h1>Welcome to Dynamic Viability Analysis</h1>
        <p class="explanation">Quickly analyze the viability of cancer cells.</p>
        <ol class="steps-list">
            <li><strong><span class="color:red;">Import:</span></strong> Upload your cell images to start the analysis.</li>
            <li><strong>Project:</strong> Organize your images and data within projects.</li>
            <li><strong>Analysis:</strong> Utilize our cropping tools and get real-time viability results.</li>
        </ol>
        <p class="help">Need help? Visit our <a href="#HelpNav">Help Section</a> or <a href="mailto:admin@vicatech.com">contact support</a>.</p>
    </div>
    <div class="page" id="Import" style="display: none;">
        <div id="importPageInput" class="section" style="display: flex;" >
            <div class="section-remaining">
                <form class="form" id="importForm">
                    <div style=" width: 100%;display: flex; align-items: center;justify-content: space-between;gap: 4px;margin-bottom: 20px;">
                        <h2>Import</h2>
                        <button type="submit" class="button normal" id="submitBtnImport" style="padding-right: 16px; padding-left:16px;" >
                            <span>Submit</span>
                        </button>
                    </div>
                    <div class="row">
                        <p>Project </p>
                        <div class="custom-select" style="display: flex; align-items:center;gap: 8px;" >
                            <select class="project-select-import" id="project-select">
                                <option value="">Select project</option>
                            </select>
                            <div class="button small" style="border-radius: 100%;" id="importToProject" >
                                <svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                    <g id="SVGRepo_iconCarrier"> <path d="M4 12H20M12 4V20" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> 
                                    </g>
                                </svg>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <p>Name</p>
                        <input type="text" id="cellName" />
                    </div>
                    <div class="row">
                        <p>Phase Quantity</p>
                        <div class="choicebox">
                            <label class="choicebox-container">2
                                <input type="radio" name="radio" value="2">
                                <span class="checkmark"></span>
                            </label>
                            <label class="choicebox-container">3
                                <input type="radio" name="radio" value="3">
                                <span class="checkmark"></span>
                            </label>
                        </div>
                    </div>
                    <div class="" id="phaseUpload" >

                    </div>
                </form>
            </div>
        </div>
        
        <div id="importPageResult" class="section" style="display: none;">
            <div class="buttonContainer">
                <div  style="flex: 1 ; width:100%"></div>
                <div  style="display: flex ; flex-direction:row; gap: 4px;">
                    <div class="button small" id="resultToImport">
                        <svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M8 5L3 10L8 15" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M3 10H11C16.5228 10 21 14.4772 21 20V21" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>                        
                    </div>
                </div>
            </div>
            <div class="section-remaining">
                <div id="import-result-container"></div>
            </div>
        </div>
    </div>
    <div class="page" id="Project" style="display: none;">
        <div id="projectPage1" class="section" style="display: flex;" >
            <div class="buttonContainer">
                <div  style="flex: 1 ; width:100%"></div>
                <div  style="display: flex ; flex-direction:row; gap: 4px;">
                    <div class="button normal" id="sNewProjectBtn" >
                        <span>Add new project</span>
                    </div>
                </div>
            </div>
            <div>
                <ul class="project-list" id="projects"></ul>
            </div>
        </div>
        <div id="projectPage2" class="section" style="display: none;">
            <div class="buttonContainer">
                <div  style="flex: 1 ; width:100%"></div>
                <div  style="display: flex ; flex-direction:row; gap: 4px;">
                    <div class="button normal" id="sProjectListBtn">
                        <span>Project List</span>
                    </div>
                </div>
            </div>
            <form class="form" style="max-width: 600px;" id="addProjectForm"> 
                <div class="row">
                    <p> Owner</p>
                    <input type="text"  id="authorAdd"/>
                </div>
                <div class="row">
                    <p>Project Name</p>
                    <input type="text" id="projectNameAdd" />
                </div>
                <div class="row">
                    <p>Description</p>
                    <input type="text" id="descriptionAdd" />
                </div>
                <div class="buttonContainer" style="justify-content: end;">
                <button type="submit" class="button normal" id="addProject" style="max-width: 200px;" >
                    <svg width="28px" height="28px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M4 12H20M12 4V20" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                    <span>Add Project</span>
                </button>
                </div>
            </form>
        </div>
        <div id="projectPageOverview" class="section" style="display: none ; flex-direction:column; max-height:max-content; justify-content:between" >
            <div class="buttonContainer">
                <div  style="flex: 1 ; width:100%"></div>
                <div  style="display: flex ; flex-direction:row; gap: 4px;">
                    <div class="button normal" id="backOverviewButton">
                        <span>Back</span>
                    </div>
                    <div class="button normal" id="exportBtn" style="display: flex; gap: 6px; align-items:center; padding:12px ">
                        <span class="font-size:small;">Export</span>
                        <svg fill="#ffffff" width="24px" height="24px" viewBox="0 0 1920 1920" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="m0 1016.081 409.186 409.073 79.85-79.736-272.867-272.979h1136.415V959.611H216.169l272.866-272.866-79.85-79.85L0 1016.082ZM1465.592 305.32l315.445 315.445h-315.445V305.32Zm402.184 242.372-329.224-329.11C1507.042 187.07 1463.334 169 1418.835 169h-743.83v677.647h112.94V281.941h564.706v451.765h451.765v903.53H787.946V1185.47H675.003v564.705h1242.353V667.522c0-44.498-18.07-88.207-49.581-119.83Z" fill-rule="evenodd"></path> </g></svg>
                    </div>
                </div>
            </div>
            <table class="flex:1; height:100%;" >
                <thead >
                    <tr>
                        <th>Cell Name</th>
                        <th>Area<br><span style="font-size: small;">(last phase)</span></th>
                        <th>Perimeter<br><span style="font-size: small;">(last phase)</span></th>
                        <th>Roundness<br><span style="font-size: small;">(last phase)</span></th>
                        <th>Particle Count<br><span style="font-size: small;">(last phase)</span></th>
                        <th>Viability<br><span style="font-size: small;">(last phase)</span></th>
                    </tr>
                </thead>
                <tbody id="tableContent"></tbody>
            </table>
            <div class="buttonContainer">
                <div  style="flex: 1 ; width:100%"></div>
                <div style="display:flex; align-items:center; flex-direction:row; gap: 4px;" id="overviewProjectButtons"></div>
            </div>
        </div>
    </div>
    <div class="page" id="Crop" style="display: none;">
        <div class="toolbox">
            <input type="file" id="inputImage" accept="image/*" style="display: none;">
            <button id="select" style="display: flex; gap: 4px; align-items:center;">
                <span  style="font-size: 18px;" >Open</span>
                <svg width="26px" height="26px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M15.7955 15.8111L21 21M18 10.5C18 14.6421 14.6421 18 10.5 18C6.35786 18 3 14.6421 3 10.5C3 6.35786 6.35786 3 10.5 3C14.6421 3 18 6.35786 18 10.5Z" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
            </button>
            <button id="rotateLeft">
                <svg width="26px" height="26px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" transform="matrix(-1, 0, 0, 1, 0, 0)"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M11.5 20.5C6.80558 20.5 3 16.6944 3 12C3 7.30558 6.80558 3.5 11.5 3.5C16.1944 3.5 20 7.30558 20 12C20 13.5433 19.5887 14.9905 18.8698 16.238M22.5 15L18.8698 16.238M17.1747 12.3832L18.5289 16.3542L18.8698 16.238" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
            </button>
            <button id="rotateRight">
                <svg width="26px" height="26px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M11.5 20.5C6.80558 20.5 3 16.6944 3 12C3 7.30558 6.80558 3.5 11.5 3.5C16.1944 3.5 20 7.30558 20 12C20 13.5433 19.5887 14.9905 18.8698 16.238M22.5 15L18.8698 16.238M17.1747 12.3832L18.5289 16.3542L18.8698 16.238" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
            </button>
            <button id="zoomIn" >
                <svg width="26px" height="26px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" fill="#ffffff"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <title>zoom-in</title> <desc>Created with Sketch Beta.</desc> <defs> </defs> <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage"> <g id="Icon-Set" sketch:type="MSLayerGroup" transform="translate(-308.000000, -1139.000000)" fill="#fff"> <path d="M321.46,1163.45 C315.17,1163.45 310.07,1158.44 310.07,1152.25 C310.07,1146.06 315.17,1141.04 321.46,1141.04 C327.75,1141.04 332.85,1146.06 332.85,1152.25 C332.85,1158.44 327.75,1163.45 321.46,1163.45 L321.46,1163.45 Z M339.688,1169.25 L331.429,1161.12 C333.592,1158.77 334.92,1155.67 334.92,1152.25 C334.92,1144.93 328.894,1139 321.46,1139 C314.026,1139 308,1144.93 308,1152.25 C308,1159.56 314.026,1165.49 321.46,1165.49 C324.672,1165.49 327.618,1164.38 329.932,1162.53 L338.225,1170.69 C338.629,1171.09 339.284,1171.09 339.688,1170.69 C340.093,1170.3 340.093,1169.65 339.688,1169.25 L339.688,1169.25 Z M326.519,1151.41 L322.522,1151.41 L322.522,1147.41 C322.522,1146.85 322.075,1146.41 321.523,1146.41 C320.972,1146.41 320.524,1146.85 320.524,1147.41 L320.524,1151.41 L316.529,1151.41 C315.978,1151.41 315.53,1151.59 315.53,1152.14 C315.53,1152.7 315.978,1153.41 316.529,1153.41 L320.524,1153.41 L320.524,1157.41 C320.524,1157.97 320.972,1158.41 321.523,1158.41 C322.075,1158.41 322.522,1157.97 322.522,1157.41 L322.522,1153.41 L326.519,1153.41 C327.07,1153.41 327.518,1152.96 327.518,1152.41 C327.518,1151.86 327.07,1151.41 326.519,1151.41 L326.519,1151.41 Z" id="zoom-in" sketch:type="MSShapeGroup"> </path> </g> </g> </g></svg>
            </button>
            <button id="zoomOut">
                <svg width="26px" height="26px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" fill="#ffffff"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <title>zoom-out</title> <desc>Created with Sketch Beta.</desc> <defs> </defs> <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage"> <g id="Icon-Set" sketch:type="MSLayerGroup" transform="translate(-360.000000, -1139.000000)" fill="#ffffff"> <path d="M373.46,1163.45 C367.17,1163.45 362.071,1158.44 362.071,1152.25 C362.071,1146.06 367.17,1141.04 373.46,1141.04 C379.75,1141.04 384.85,1146.06 384.85,1152.25 C384.85,1158.44 379.75,1163.45 373.46,1163.45 L373.46,1163.45 Z M391.688,1169.25 L383.429,1161.12 C385.592,1158.77 386.92,1155.67 386.92,1152.25 C386.92,1144.93 380.894,1139 373.46,1139 C366.026,1139 360,1144.93 360,1152.25 C360,1159.56 366.026,1165.49 373.46,1165.49 C376.672,1165.49 379.618,1164.38 381.932,1162.53 L390.225,1170.69 C390.629,1171.09 391.284,1171.09 391.688,1170.69 C392.093,1170.3 392.093,1169.65 391.688,1169.25 L391.688,1169.25 Z M378.689,1151.41 L368.643,1151.41 C368.102,1151.41 367.663,1151.84 367.663,1152.37 C367.663,1152.9 368.102,1153.33 368.643,1153.33 L378.689,1153.33 C379.23,1153.33 379.669,1152.9 379.669,1152.37 C379.669,1151.84 379.23,1151.41 378.689,1151.41 L378.689,1151.41 Z" id="zoom-out" sketch:type="MSShapeGroup"> </path> </g> </g> </g></svg>
            </button>
            <button id="crop" style="display: flex; gap: 4px; align-items:center;">
                <span  style="font-size: 18px;" >Crop</span>
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M6 3V14.8C6 15.9201 6 16.4802 6.21799 16.908C6.40973 17.2843 6.71569 17.5903 7.09202 17.782C7.51984 18 8.0799 18 9.2 18H15M21 18H18M18 21V9.2C18 8.0799 18 7.51984 17.782 7.09202C17.5903 6.71569 17.2843 6.40973 16.908 6.21799C16.4802 6 15.9201 6 14.8 6H9M3 6H6" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
            </button>
        </div>
        <div class="img-container-mock">
            <h2>Import an image to start cropping</h2>
        </div>
        <div class="img-container" style="display: none;">
        </div>
    </div>
    <div class="page" id="Settings" style="display: none;">
        <div class="section" style="display: flex;" >
            <div class="section-remaining">
                <form class="form" id="settingsForm">
                    <div style=" width: 100%;display: flex; align-items: center;justify-content: space-between;gap: 4px;margin-bottom: 20px;">
                        <h2>Settings</h2>
                        <button type="submit" class="button normal" id="submitBtnSettings" style="padding-right: 16px; padding-left:16px;" >
                            <span>Submit</span>
                        </button>
                    </div>
                    <div class="row">
                        <p>API Key</p>
                        <input type="text" id="apiKey" />
                    </div>
                    <div class="row">
                        <p>API URL</p>
                        <input type="text" id="apiUrl" />
                    </div>
                </form>
                <form class="form" id="settingsForm">
                    <div style=" width: 100%;display: flex; align-items: center;justify-content: space-between;gap: 4px;margin-bottom: 20px;">
                        <h2>Settings</h2>
                        <button type="submit" class="button normal" id="submitBtnSettings" style="padding-right: 16px; padding-left:16px;" >
                            <span>Submit</span>
                        </button>
                    </div>
                    <div class="row">
                        <p>API Key</p>
                        <input type="text" id="apiKey" />
                    </div>
                    <div class="row">
                        <p>API URL</p>
                        <input type="text" id="apiUrl" />
                    </div>
                </form>
                <form class="form" id="settingsForm">
                    <div style=" width: 100%;display: flex; align-items: center;justify-content: space-between;gap: 4px;margin-bottom: 20px;">
                        <h2>Settings</h2>
                        <button type="submit" class="button normal" id="submitBtnSettings" style="padding-right: 16px; padding-left:16px;" >
                            <span>Submit</span>
                        </button>
                    </div>
                    <div class="row">
                        <p>API Key</p>
                        <input type="text" id="apiKey" />
                    </div>
                    <div class="row">
                        <p>API URL</p>
                        <input type="text" id="apiUrl" />
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="myModal" class="modal">
        <div class="modal-content">
            <div class="row" style="display: flex; flex:1; justify-content:space-between; width:100%; align-items:center">
                <div id="modalTitle"></div>
                <span class="close">&times;</span>
            </div>
          <div class="modal-content-body" id="modalBody">
            <div id="modalContent"></div>
          </div>
        </div>
      
    </div>
    
</body>
</html>
